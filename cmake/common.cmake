set(CMAKE_SYSTEM_PROCESSOR x86_64)
if (NOT DEFINED SHIRO_VERSION)
    set(SHIRO_VERSION "STANDALONE")
endif ()
set(CMAKE_VERBOSE_MAKEFILE ON)
find_program(CLANG NAMES clang REQUIRED)
find_program(CLANG++ NAMES clang++ REQUIRED)
find_program(LLD NAMES lld REQUIRED)

if (NOT EXISTS "${CMAKE_BINARY_DIR}/CRT" AND NOT DEFINED SHIRO_COMMON_OUTPUT_ONCE)
    message(WARNING "CRT directory does not exist: ${CMAKE_BINARY_DIR}/CRT. Please run the CRT build first.")
endif ()

if (NOT DEFINED SHIRO_COMMON_OUTPUT_ONCE)
    message(NOTICE "=================================================")
    message(NOTICE "Overwriting default toolchain with Clang/LLVM")
    message(NOTICE "=================================================")
    message(STATUS "Found Clang: ${CLANG}")
    message(STATUS "Found Clang++: ${CLANG++}")
    message(STATUS "Found LLD: ${LLD}")
    set(SHIRO_COMMON_OUTPUT_ONCE ON CACHE INTERNAL "Do not print output again pls")
endif ()

set(CMAKE_C_COMPILER ${CLANG})
set(CMAKE_CXX_COMPILER ${CLANG++})
set(CMAKE_LINKER ${LLD})

if (NOT DEFINED SHIRO_COMMON_INCLUDE_ONCE)
    message(DEBUG "Including SHIRO Headers")
    include_directories(${SHIRO_PARENT_DIR}/include)
    set(INCLUDE_DIRECTORY ${SHIRO_PARENT_DIR}/include CACHE INTERNAL FORCE)
    add_compile_options(-Wno-unused-command-line-argument)
    set(SHIRO_COMMON_INCLUDE_ONCE ON CACHE INTERNAL "Do not include headers again pls")
endif ()

set(CMAKE_C_STANDARD 17)
set(CMAKE_C_STANDARD_REQUIRED ON)
set(CMAKE_C_EXTENSIONS OFF)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/lib")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin")

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/lib/debug")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/lib/release")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO "${CMAKE_BINARY_DIR}/lib/relWithDebInfo")
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL "${CMAKE_BINARY_DIR}/lib/minSizeRel")

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/lib/debug")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/lib/release")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO "${CMAKE_BINARY_DIR}/lib/relWithDebInfo")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_MINSIZEREL "${CMAKE_BINARY_DIR}/lib/minSizeRel")

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/bin/debug")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/bin/release")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO "${CMAKE_BINARY_DIR}/bin/relWithDebInfo")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_MINSIZEREL "${CMAKE_BINARY_DIR}/bin/minSizeRel")

set(CMAKE_STATIC_LIBRARY_PREFIX "")
set(CMAKE_SHARED_LIBRARY_PREFIX "")

macro(set_output_arc dir)
    set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${dir})

    set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${dir})
    set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${dir})
    set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ${dir})
    set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL ${dir})
endmacro()

macro(set_output_lib dir)
    set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${dir})

    set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_DEBUG ${dir})
    set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELEASE ${dir})
    set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO ${dir})
    set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_MINSIZEREL ${dir})
endmacro()

macro(set_output_run dir)
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${dir})

    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG ${dir})
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE ${dir})
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO ${dir})
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_MINSIZEREL ${dir})
endmacro()

macro(set_output dir)
    set_output_arc(${dir})
    set_output_lib(${dir})
    set_output_run(${dir})
endmacro()